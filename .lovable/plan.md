

## Analysis: Why High Confidence Trades are Losing

### Root Cause 1: Misleading Confidence Score

The current confidence calculation is **arbitrary and misleading**. It doesn't reflect actual win probability:

| Current Formula | Example Calculation |
|-----------------|---------------------|
| Base: 50% | 50% |
| +12% per Tier 1 pattern | +24% (RSI + BB) |
| +5% per Tier 2 pattern | +5% (Stochastic) |
| +15% RSI+BB combo bonus | +15% |
| +10% RSI+Stochastic bonus | +10% |
| **Total** | **94-95%** |

**But the actual win rate from 25 years of data is only 52-53%!**

The confidence score is counting "more patterns = more confident" when in reality:
- RSI oversold alone: 52.4% win rate
- BB lower touch alone: 52.06% win rate  
- Both together: Still ~52-53% win rate, NOT 95%

Pattern stacking doesn't multiply probabilities - it confirms the same market condition.

### Root Cause 2: R:R Mismatch with Historical Data

The pattern statistics were generated by measuring whether price moved in the expected direction within X candles. They show average pip movements of:

| Pattern | Avg Pips (24h) |
|---------|----------------|
| RSI oversold (EUR/USD) | 0.26 pips |
| BB lower touch (EUR/USD) | 0.29 pips |
| RSI overbought (EUR/USD) | 19.8 pips |

The current 1:3 R:R means:
- Stop Loss: 1 ATR (~40-60 pips)
- Take Profit: 3 ATR (~120-180 pips)

**The TP target is 400-600x larger than typical pattern-based moves!** This explains why signals that correctly predict direction still hit SL before TP.

### Solution Plan

#### 1. Fix Confidence Calculation

Replace the arbitrary formula with **actual win rates** from the database:

```text
Current (broken):
confidence = 50 + (tier1_count * 12) + combo_bonuses

New (data-driven):
confidence = average_win_rate_of_detected_patterns
```

For example, if RSI oversold (52.4%) and BB lower (52.06%) are both detected:
- New confidence = average(52.4, 52.06) = 52.2%

This gives users a realistic expectation.

#### 2. Reduce R:R from 1:3 to 1:2.2

Update the level calculation in `scan-opportunities`:

| Setting | Current | New |
|---------|---------|-----|
| SL Multiplier | 1.0 ATR | 1.0 ATR |
| TP1 Multiplier | 3.0 ATR | 2.2 ATR |
| TP2 Multiplier | 4.5 ATR | 3.0 ATR |
| R:R Ratio | 1:3.0 | 1:2.2 |

This aligns better with how the original pattern statistics measured success - shorter targets that can realistically be hit within the evaluation window.

### Technical Changes

| File | Changes |
|------|---------|
| `supabase/functions/scan-opportunities/index.ts` | Fix confidence calculation to use actual win rates; reduce R:R to 1:2.2 |
| `supabase/functions/generate-prediction/index.ts` | Same R:R adjustment |

### Why This Will Improve Results

1. **Realistic expectations**: 52% confidence instead of 95% helps users understand the actual edge
2. **Achievable targets**: 2.2x ATR targets are more likely to be hit before SL
3. **Data alignment**: The R:R now matches the original pattern statistics methodology
4. **True edge**: Even 52% win rate with 1:2.2 R:R is profitable over time

